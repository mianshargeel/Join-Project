<section class="addTask">
  <div class="addTaskMaxWidth">
    <header class="addTaskHeader">
      <h1 class="headingAddTask">Add Task</h1>
    </header>


    <main class="addTaskContent">

      <div class="leftSide">
        <label>
          <p class="layoutLeftName">Title <span class="requred">*</span></p>
          <input class="enterTitle inputTitle" type="text" placeholder="Enter a title" required [(ngModel)]="title" />
        </label><br />

        <label>
          <p class="layoutLeftName">Description</p>
          <textarea class="enterTitle inputDescription" type="text" placeholder="Enter a Description"
            [(ngModel)]="description"></textarea>
        </label><br />

        <label>
          <p class="layoutLeftName">Due date <span class="requred">*</span></p>
          <input #dueDateInput class="enterTitle inputData" type="date" (change)="validateDueDate()" [attr.lang]="'en'"
            required [(ngModel)]="duedate" />
        </label>
      </div>


      <div class="rightSide">
        <p class="layoutLeftName">Priority</p>
        <div class="priority layoutLeftName">
          <a class="prioTasks" (click)="priority = 'urgent'">Urgent
            <img src="../../../assets/imgs/imgs_story2/addTask/Urgent1.png" alt="img Task" /></a>

          <a class="prioTasks" (click)="priority = 'medium'">Medium
            <img src="../../../assets/imgs/imgs_story2/addTask/Medium1.png" alt="img Task" /></a>
          <a class="prioTasks" (click)="priority = 'low'">Low
            <img src="../../../assets/imgs/imgs_story2/addTask/Low1.png" alt="img Task" /></a>
        </div>

        <!-- Assignees field -->
        <div class="assignee-dropdown">
          <label for="">Assigne to*</label>
          <div class="assignee-input-wrapper" (click)="toggleDropdown()">
            <input type="text" [readonly]="true" placeholder="Select contacts to assign" class="assignee-input" />
            <span class="dropdown-arrow"></span>
          </div>

          @if (dropdownOpen) {
          <div class="dropdown-content">
            @for (contact of firebaseTaskService.contactList; track contact.id) {
            <div class="dropdown-item">
              <span class="avatar" [style.backgroundColor]="getAvatarColor(contact.id ?? '')">
                {{ generateInitials(contact.name) }}
              </span>
              <span class="contact-name">{{ contact.name }}</span>
              <input type="checkbox" [value]="contact.id"
                [checked]="contact.id && selectedAssignees.includes(contact.id)" (change)="onCheckboxChange($event)" />
            </div>
            }
          </div>
          }
        </div>
        <!-- Showing selected assignees as colored bubbles -->
        @if (!dropdownOpen) {
            <div class="selected-assignees">
              @for (id of selectedAssignees; track id) {
                <span 
                  class="avatar-badge"
                  [style.backgroundColor]="getAvatarColor(id)"
                >
                  {{ getContactInitials(id) }}
                </span>
              }
            </div>
          }

        <label>
          <p class="layoutLeftName">Category <span class="requred">*</span></p>
          <select required class="enterTitle selectCategory" [(ngModel)]="category">
            <option value="Technical Task">Technical Task</option>
            <option value="User Story">User Story</option>
          </select>
        </label><br />
        <!-- ----------------------------- -->

   <div>
  <label>Subtasks</label>

  <!-- Subtask input field -->
  <div style="position: relative; display: inline-block; width: 100%;">
    <input
      type="text"
      placeholder="Add new subtask"
      [(ngModel)]="subtasksInput"
      [readonly]="!isTyping"
      (click)="enableTyping()"
      (keydown.enter)="confirmSubtask()"
      style="width: 100%; padding-right: 70px; box-sizing: border-box; padding: 16px;"
    />
    @if (!isTyping) {
      <span
        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 18px; color: purple;"
        (click)="enableTyping()">Ôºã</span>
    }
    @if (isTyping) {
      <span
        style="position: absolute; right: 40px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 16px;"
        (click)="cancelSubtask()">‚úï</span>
      <span
        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 16px;"
        (click)="confirmSubtask()">‚úî</span>
    }
  </div>

  <!-- Subtasks list -->
      @if (addedSubtasks.length > 0) {
      <ul style="margin-top: 10px; padding-left: 20px;">
          @for (sub of addedSubtasks; track $index) {
            <li
              style="list-style: none; position: relative; padding: 6px 40px 6px 6px; background: #f5f5f5; border-radius: 6px; margin-bottom: 6px;"
              (mouseenter)="hoveredIndex = $index"
              (mouseleave)="hoveredIndex = -1"
            >
              @if (editIndex === $index) {
                <!-- Editable subtask with inline icons -->
                <div style="position: relative; display: flex; align-items: center;">
                  <input
                    [(ngModel)]="editedSubtaskText"
                    (keydown.enter)="saveEdit($index)" 
                    style="width: 100%; padding-right: 50px; padding-left: 10px; box-sizing: border-box; padding: 15px;"
                  />
                  <span
                    (click)="deleteSubtask($index)"
                    style="position: absolute; right: 30px; cursor: pointer; color: grey;"
                  >üóëÔ∏è</span>
                  <span
                    (click)="saveEdit($index)"
                    style="position: absolute; right: 10px; cursor: pointer; color: purple;"
                  >‚úî</span>
                </div>
              } @else {
                ‚Ä¢ {{ sub }}
                @if (hoveredIndex === $index) {
                  <div style="position: absolute; top: 6px; right: 6px; display: flex; gap: 6px;">
                    <button (click)="startEdit($index)" style="border: none; background: transparent; cursor: pointer;">‚úèÔ∏è</button>
                    <button (click)="deleteSubtask($index)" style="border: none; background: transparent; cursor: pointer;">üóëÔ∏è</button>
                  </div>
                }
              }
            </li>
          }
        </ul>
      }
    </div>


  <!-- --------------------------------------------- -->
      </div>
    </main>

    <footer class="addTaskFooter">
      <p class="layoutLeftName"><span class="requred">*</span>This field is required</p>
      <div class="footerButtons">
        <a type="reset" class="clear">Clear</a>
        <a type="submit" class="create" (click)="createNewTask()">Create Tasks</a>
      </div>
    </footer>
  </div>
</section>







































<!-- <section class="addTask">
  <div class="addTaskMaxWidth">
    <header class="addTaskHeader">
      <h1 class="headingAddTask">Add Task</h1>
    </header>


    <main class="addTaskContent">

      <div class="leftSide">
        <label>
          <p class="layoutLeftName">Title <span class="requred">*</span></p>
          <input
            class="enterTitle inputTitle"
            type="text"
            placeholder="Enter a title"
            required
             [(ngModel)]="title"
          /> </label
        ><br />

        <label>
          <p class="layoutLeftName">Description</p>
          <textarea
            class="enterTitle inputDescription"
            type="text"
            placeholder="Enter a Description"
            [(ngModel)]="description"
          ></textarea></label
        ><br />

        <label>
          <p class="layoutLeftName">Due date <span class="requred">*</span></p>
          <input
            #dueDateInput
            class="enterTitle inputData"
            type="date"
            (change)="validateDueDate()"
            [attr.lang]="'en'"
            required
            [(ngModel)]="duedate"
          />
        </label>
      </div>


      <div class="rightSide">
        <p class="layoutLeftName">Priority</p>
        <div class="priority layoutLeftName">
          <a class="prioTasks" (click)="priority = 'urgent'">Urgent
            <img
              src="../../../assets/imgs/imgs_story2/addTask/Urgent1.png"
              alt="img Task"
          /></a>
          
          <a class="prioTasks" (click)="priority = 'medium'">Medium
            <img
              src="../../../assets/imgs/imgs_story2/addTask/Medium1.png"
              alt="img Task" /></a
          >
          <a class="prioTasks" (click)="priority = 'low'">Low
            <img
              src="../../../assets/imgs/imgs_story2/addTask/Low1.png"
              alt="img Task" /></a>
        </div>

        <label class="assignedTo"> 
          <p class="layoutLeftName">Assigned to</p>

          <ng-select
            class="selectCotacts"
            [items]="firebaseTaskService.contactList"
            [multiple]="true"
            bindLabel="initials"
            [closeOnSelect]="false"
            bindValue="id"
            [(ngModel)]="selectedAssignees">
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="contactInfo">
                <div class="contact-avatar" [style.background-color]="item.color">
                  {{ item.initials }}
                </div>
                {{ item.name }} 
              </div>
              <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> 
            </ng-template>
            <ng-template ng-label-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="contactInfo">
                <div class="contact-avatar" [style.background-color]="item.color">
                  {{ item.initials }}
                </div>
              </div>
            </ng-template>
          </ng-select>
        </label><br />

        <label>
          <p class="layoutLeftName">Category <span class="requred">*</span></p>
          <select required class="enterTitle selectCategory" [(ngModel)]="category">
            <option value="Technical Task">Technical Task</option>
             <option value="User Story">User Story</option>
          </select> </label
        ><br />

        <label>
          <p class="layoutLeftName">Subtasks <span class="requred">*</span></p>
           <select required class="enterTitle subtasks" [(ngModel)]="subtasksInput">
            <option>Add new subask</option>
          </select>
   
          </label>
      </div>
    </main>

    <footer class="addTaskFooter">
      <p class="layoutLeftName"><span class="requred">*</span>This field is required</p>
      <div class="footerButtons">
        <a type="reset" class="clear">Clear</a>
       <a type="submit" class="create" (click)="createNewTask()">Create Tasks</a>
      </div>
    </footer>
  </div>
</section> -->